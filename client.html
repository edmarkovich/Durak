<body>
<script>

let socket = new WebSocket("ws://192.168.1.13:5678")

function makePlayerArea(name) {
	player = document.createElement('div');
	player.setAttribute('class', name)

	player.appendChild(document.createTextNode(name));

	player.appendChild(document.createElement('span'));
	player.appendChild(document.createElement('span'));
	player.appendChild(document.createElement('span'));
	player.appendChild(document.createElement('span'));
	player.appendChild(document.createElement('span'));
	player.appendChild(document.createElement('span'));

	document.body.appendChild(player)
}

function populatePlayerArea(name, hand) {
	player = document.getElementsByClassName(name)[0]
	console.log(player)

	for (i=0; i<6; i++) {
		player.getElementsByTagName('span')[i].innerHTML = '<i onclick="send_card(\''+hand[i]+'\')">'+hand[i]+"</i>"
	}


}
socket.onopen = function(e) {
	messages = document.createElement('ul');
	document.body.appendChild(messages);

	makePlayerArea("Ed")
	makePlayerArea("Jon")
	makePlayerArea("Mike")
	makePlayerArea("Conway")
};

socket.onmessage = function(event) {
	var messages = document.getElementsByTagName('ul')[0],
			message = document.createElement('li'),
			content = document.createTextNode(event.data);
	message.appendChild(content);
	messages.appendChild(message);

	payload = JSON.parse(event.data)
	if (!('players' in payload)) { return }

	for (id in payload.players) {
		console.log("YYYY", id)
		name = payload.players[id].name
		hand = payload.players[id].hand
		console.log("XXX", name, hand)
		populatePlayerArea(name, hand)
	}
	return;

	try {
		//messages.textContent = ""

		for (i=0; i<6; i++) {
			player.getElementsByTagName('span')[i].innerHTML = '<i onclick="send_card(\''+hand[i]+'\')">'+hand[i]+"</i>"
		}

		//messages.textContent = content
	} catch (e) {
		//console.log(e);
		return;
	}
	//messages.appendChild(content);
};

function send_card(card) {
	console.log("send", card)
	socket.send('{"card":"'+card+'"}')
}

function login() {
	socket.send('{"action":"join","name":"Ed"}')
	socket.send('{"action":"join","name":"Jon"}')
	socket.send('{"action":"join","name":"Mike"}')
	socket.send('{"action":"join","name":"Conway"}')
}

</script>
	<button onclick="login();">FF</button>
	<input type="text" id="command" value='{"action":"join","name":"Ed"}'  />
	<button onclick="socket.send(document.getElementById('command').value);">Eh</button>
</body>
